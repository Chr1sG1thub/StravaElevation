<!DOCTYPE html>
<html>
<head><title>JSONP Debug</title></head>
<body>
<script src='https://unpkg.com/@turf/turf@7.0.0/turf.min.js'></script>
<script>
let callbackId = 0;

function calculateElevationGain(trackpoints) {
  const coords = trackpoints.map(([lat, lon]) => [lon, lat]);
  let line = turf.lineString(coords);
  
  let tolerance = 0.0001;
  while (line.geometry.coordinates.length > 100) {
    line = turf.simplify(line, { tolerance, highQuality: false });
    tolerance *= 1.2;
  }
  
  const locations = line.geometry.coordinates
    .map(([lon, lat]) => `${lat.toFixed(6)},${lon.toFixed(6)}`)
    .join('|');
    
  const cbName = `cb_${++callbackId}`; // Simple, short name
  console.log('üîç Expecting callback:', cbName);
  
  // ‚úÖ TEST: Log if callback exists BEFORE script load
  console.log('Callback defined?', !!window[cbName]);
  
  window[cbName] = function(data) {
    console.log('üéâ CALLBACK EXECUTED!', data);
    // Process data.results...
    document.body.innerHTML += '<h1>‚úÖ JSONP WORKS!</h1>';
  };
  
  console.log('Callback defined?', !!window[cbName]); // Should be true
  
  const script = document.createElement('script');
  script.src = `https://api.opentopodata.org/v1/eudem25m?locations=${locations}&interpolation=bilinear&jsonp=${cbName}`;
  console.log('üì° Loading:', script.src);
  
  document.head.appendChild(script);
}

calculateElevationGain([
  [42.5432, 2.4167], [42.5500, 2.4200], 
  [42.5600, 2.4300], [42.5700, 2.4400]
]);
</script>
</body>
</html>
