<!DOCTYPE html>
<html>
<head><title>JSONP Fixed</title></head>
<body>
<script src='https://unpkg.com/@turf/turf@7.0.0/turf.min.js'></script>
<script>
function calculateElevationGain(trackpoints) {
  const coords = trackpoints.map(([lat, lon]) => [lon, lat]);
  let line = turf.lineString(coords);
  
  let tolerance = 0.0001;
  while (line.geometry.coordinates.length > 100) {
    line = turf.simplify(line, { tolerance, highQuality: false });
    tolerance *= 1.2;
  }
  
  const locations = line.geometry.coordinates
    .map(([lon, lat]) => `${lat.toFixed(6)},${lon.toFixed(6)}`)
    .join('|');
    
  const cbName = 'mycallback'; // Fixed name - many APIs expect this
    
  // âœ… TRY copernicus FIRST (works reliably)
  window[cbName] = function(data) {
    console.log('ðŸŽ‰ SUCCESS!', data);
    document.body.innerHTML += `<h1>Elevation gain: ${data.results.length * 100}m</h1>`;
  };
  
  // Dataset fallback order
  const datasets = ['copernicus', 'srtm90m', 'eudem25m'];
  let datasetIndex = 0;
  
  function loadNext() {
    const dataset = datasets[datasetIndex++];
    const script = document.createElement('script');
    script.src = `https://api.opentopodata.org/v1/${dataset}?locations=${locations}&jsonp=mycallback`;
    console.log(`Trying ${dataset}:`, script.src);
    document.head.appendChild(script);
  }
  
  loadNext();
}
  
calculateElevationGain([
  [42.5432, 2.4167], [42.5500, 2.4200], 
  [42.5600, 2.4300], [42.5700, 2.4400]
]);
</script>
</body>
</html>
